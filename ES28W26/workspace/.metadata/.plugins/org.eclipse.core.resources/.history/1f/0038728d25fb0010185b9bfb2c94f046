/*
 * Soleil Demick
 * ES28W26 Lab 3
 * SolenoidButton.c
 * Description:
 * Activates a solenoid from an external button input
 *
 * Pins used:
 *   PB4 - output, controls transistor
 *   PB5 - input, external button
 *
 *
 */

// Includes
#include "ES28.h"
#include "uart.h"
#include <stdio.h>

#define GPIOBEN (1U<<1) // enable clock access to port B

#define TRANSISTOR_PIN (1U<<4)

int main(void) {
	uart2_init();
	// enable clock access to port B
	RCC->IOPENR |= GPIOBEN;

	// Set transistor pin as output
	GPIOB->MODER &= ~GPIO_MODER_MODE4_Msk;
	GPIOB->MODER |= (GPIO_OUTPUT << GPIO_MODER_MODE4_Pos);

	// variable to control the state of the door latch
	enum {OPEN, CLOSED} latch_t;
	latch_t latch_state = CLOSED;

	while (1) {
		// poll keyboard
		keypress = uart2_read();

		// switch latch state on key press
		if ((keypress == 'O' || keypress == 'o') && latch_state == CLOSED) {
			latch_state = OPEN;

		} else if (keypress == 'C' || keypress == 'c') {
			latch_state = CLOSED;
		}






	}
	return 0;
}
